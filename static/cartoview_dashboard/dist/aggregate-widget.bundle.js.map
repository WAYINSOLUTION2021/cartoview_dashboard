{"version":3,"sources":["webpack:///./src/components/FieldSet.jsx?d030****","webpack:///./src/events/Events.jsx?1090***","webpack:///./~/events/events.js?7c71***","webpack:///./src/aggregate-widget.jsx"],"names":["JSONField","props","Object","defineProperty","get","JSON","parse","refs","textarea","value","set","newValue","stringify","enumerable","configurable","render","ref","FieldSet","state","schema","getSchema","data","getInitialData","fields","keys","map","field","key","getValue","name","className","f","fieldSet","indexOf","type","getSelectOptions","label","charAt","toUpperCase","slice","options","getData","AggregateWidget","wpsClient","WpsClient","geoserverUrl","aggregateResult","configFieldSetClass","ConfigFieldSet","setConfig","config","attachToMapWidget","componentDidMount","mapWidget","update","context","configManager","getWidget","ready","getView","calculateExtent","eventName","on","extent","typeName","assign","filters","minx","miny","maxx","maxy","aggregate","then","setData","setState","AggregationResults","BaseWidget","displayName","console","log","layers","attributes","widget","getConfig","onChange","e","getMapLayersData","dash","widgets","mapId","res","objects","target","updateAttributes","aggregationAttribute","aggregationFunction","defaultValue","mapWidgets","getMapWidgets","filter","widgetId","title","m","layer_params","isNumber","a","attribute_type","attribute","attribute_label","getAttributesData","setLayers","ConfigForm","Dashboard","registerWidget"],"mappings":"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P,CAAYgB,OAAZ,EAAqBf,GAArB,CAAyB;AAAA;AAAA,iBAAsBE;AAAtB,mBAA4Ba,QAAQb,GAAR,CAA5B;AAAA,OAAzB,CAAP;AACD,KAFD,MAGK,IAAG,OAAOa,OAAP,IAAkB,UAArB,EAAiC;AACpC,aAAOA,QAAQ,IAAR,EAAc,KAAKtB,KAAL,CAAWG,IAAzB,CAAP;AACD;AACD,WAAO,IAAP;AACD,G;;qBACDoB,O,sBAAS;AAAA;;AACP,QAAIpB,OAAO,EAAX;AACAnB,WAAOsB,IAAP,CAAY,KAAKD,MAAjB,EAAyBE,GAAzB,CAA6B,UAACE,GAAD,EAAS;AAAEN,WAAKM,GAAL,IAAY,OAAKJ,MAAL,CAAYI,GAAZ,EAAiBlB,KAA7B;AAAqC,KAA7E;AACA,WAAOY,IAAP;AACD,G;;;;;kBAGYJ,Q;;;;;;;;;;;;AC3Ff;;kBACe,0B;;;;;;;ACDf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,eAAe,SAAS;AACxB;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA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","file":"aggregate-widget.bundle.js","sourcesContent":["import React, {Component} from 'react';\r\n\r\nclass JSONField extends Component{\r\n  constructor(props){\r\n    super(props);\r\n    Object.defineProperty(this, 'value', {\r\n      get: () => { return JSON.parse(this.refs.textarea.value); },\r\n      set: (newValue) => { this.refs.textarea.value = JSON.stringify(newValue || {}); },\r\n      enumerable: true,\r\n      configurable: true\r\n    });\r\n  }\r\n  render(){\r\n    const {...props} = this.props;\r\n    delete props.ref;\r\n    return <textarea {...props} ref=\"textarea\" />;\r\n  }\r\n}\r\nclass FieldSet extends Component{\r\n  constructor(props){\r\n    super(props);\r\n    this.state = {\r\n      schema: props.schema || this.getSchema(props),\r\n      data: props.data || this.getInitialData(props)\r\n    };\r\n    this.fields = {};\r\n  }\r\n  getSchema(){\r\n    return {};\r\n  }\r\n  getInitialData(){\r\n    return {};\r\n  }\r\n  render(){\r\n    const {schema, data} = this.state;\r\n    return <div>\r\n      {Object.keys(schema).map(key => this.field(key, schema[key], schema[key].getValue ? schema[key].getValue(data) : data[key] || null))}\r\n    </div>\r\n  }\r\n\r\n  field(name, schema, value){\r\n    var {props={}} = schema;\r\n    props.className = \"form-control\";\r\n    props.ref = (f) => {\r\n      if(f){\r\n        f.value = value;\r\n        this.fields[name] = f;\r\n        f.fieldSet = this;\r\n      }\r\n    };\r\n    var field = null;\r\n\r\n    if(['text', 'number', 'url', 'email'].indexOf(schema.type) != -1){\r\n      props.type = schema.type;\r\n      field = <input {...props} />;\r\n    }\r\n    else if(schema.type == \"textarea\"){\r\n      field = <textarea {...props} />;\r\n    }\r\n    else if(schema.type == \"json\"){\r\n      field = <JSONField {...props}/>\r\n    }\r\n    else if(schema.type == 'select'){\r\n      field =  <select {...props}>\r\n        {this.getSelectOptions(name, schema, value)}\r\n      </select>;\r\n    }\r\n    var label = schema.label || (name.charAt(0).toUpperCase() + name.slice(1));\r\n    return <div className=\"form-group\">\r\n      <label>{label}</label>\r\n      {field}\r\n    </div>;\r\n  }\r\n  getSelectOptions(name, schema, value){\r\n    var {options} = schema;\r\n    if(!options) return null;\r\n    if(typeof options == \"object\"){\r\n      return Object.keys(options).map(key => <option value={key}>{options[key]}</option>)\r\n    }\r\n    else if(typeof options == 'function' ){\r\n      return options(this, this.state.data);\r\n    }\r\n    return null\r\n  }\r\n  getData(){\r\n    var data = {};\r\n    Object.keys(this.fields).map((key) => { data[key] = this.fields[key].value; });\r\n    return data;\r\n  }\r\n}\r\n\r\nexport default FieldSet;\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/FieldSet.jsx","import {EventEmitter}  from 'events';\r\nexport default new EventEmitter();\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/events/Events.jsx","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      } else {\n        // At least give some kind of context to the user\n        var err = new Error('Uncaught, unspecified \"error\" event. (' + er + ')');\n        err.context = er;\n        throw err;\n      }\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        args = Array.prototype.slice.call(arguments, 1);\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    args = Array.prototype.slice.call(arguments, 1);\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else if (listeners) {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.prototype.listenerCount = function(type) {\n  if (this._events) {\n    var evlistener = this._events[type];\n\n    if (isFunction(evlistener))\n      return 1;\n    else if (evlistener)\n      return evlistener.length;\n  }\n  return 0;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  return emitter.listenerCount(type);\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/events/events.js\n// module id = 20\n// module chunks = 0 4 5 6 7","import React from 'react';\r\nimport FieldSet from './components/FieldSet.jsx';\r\nimport Events from './events/Events.jsx';\r\n\r\nclass AggregateWidget extends BaseWidget {\r\n    static displayName = \"Aggregate Widget\";\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.wpsClient = new WpsClient({\r\n            geoserverUrl: \"/geoserver\"\r\n        });\r\n        this.state.aggregateResult = \"NaN\";\r\n        this.configFieldSetClass = ConfigFieldSet;\r\n    }\r\n\r\n    setConfig(config) {\r\n        super.setConfig(config);\r\n        this.attachToMapWidget(config)\r\n    }\r\n\r\n    componentDidMount() {\r\n        if (this.state.config.mapWidget) {\r\n            this.attachToMapWidget(this.state.config)\r\n        }\r\n        this.update(this.state.config,);\r\n        super.componentDidMount()\r\n    }\r\n\r\n    attachToMapWidget(config) {\r\n        var mapWidget = this.context.configManager.getWidget(config.mapWidget);\r\n        if (mapWidget && mapWidget.ready)\r\n        // update widget once attached to a map, otherwise it will wait to next map change.\r\n            this.update(config, mapWidget.map.getView().calculateExtent())\r\n        var eventName = 'mapExtentChanged' + '_' + config.mapWidget;\r\n        Events.on(eventName, (map, extent) => {\r\n            this.update(this.state.config, extent);\r\n        });\r\n    }\r\n\r\n    update(config, extent) {\r\n        if (config.typeName) {\r\n            config = Object.assign({}, config)\r\n            if (extent) {\r\n                config.filters = {\r\n                    minx: extent[0],\r\n                    miny: extent[1],\r\n                    maxx: extent[2],\r\n                    maxy: extent[3],\r\n                }\r\n            }\r\n            this.wpsClient.aggregate(config).then((data) => {\r\n                this.setData(data);\r\n            });\r\n        }\r\n    }\r\n\r\n    setData(data) {\r\n        this.setState({\r\n            aggregateResult: data.AggregationResults[0][0]\r\n        });\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div className=\"aggregate-widget\">\r\n                <h1 className=\"text-center\">{this.state.aggregateResult}</h1>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nclass ConfigFieldSet extends FieldSet {\r\n    constructor(props) {\r\n        super(props);\r\n        console.log(props);\r\n        this.state.layers = [];\r\n        this.state.attributes = [];\r\n        this.state.map = null;\r\n    }\r\n\r\n    getInitialData(props) {\r\n        return props.widget.getConfig();\r\n    }\r\n\r\n    getSchema() {\r\n        return {\r\n            mapWidget: {\r\n                type: 'select',\r\n                label: \"Map\",\r\n                options: {},\r\n                props: {\r\n                    onChange: (e) => {\r\n                        getMapLayersData(dash.props.widgets[this.fields.mapWidget.value].props.config.mapId).then(res => {\r\n                            this.setState({data: this.getData()});\r\n                            this.setState({layers: res.objects});\r\n                        });\r\n                    }\r\n                }\r\n            },\r\n            typeName: {\r\n                type: 'select',\r\n                label: \"Layer\",\r\n                options: {},\r\n                props: {\r\n                    onChange: (e) => {\r\n                        e.target.fieldSet.updateAttributes();\r\n                    }\r\n                }\r\n            },\r\n            aggregationAttribute: {\r\n                type: 'select',\r\n                label: \"Aggregation Attribute\",\r\n                options: {}\r\n            },\r\n            aggregationFunction: {\r\n                type: 'select',\r\n                label: \"Aggregation Function\",\r\n                defaultValue: \"Sum\",\r\n                options: {\r\n                    \"Sum\": \"Sum\",\r\n                    \"Count\": \"Count\",\r\n                    \"Average\": \"Average\",\r\n                    \"Max\": \"Max\",\r\n                    \"Min\": \"Min\",\r\n                    \"Median\": \"Median\"\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    getSelectOptions(name, config, value) {\r\n        if (name == \"mapWidget\") {\r\n            var mapWidgets = this.props.widget.context.configManager.getMapWidgets();\r\n            return Object.keys(mapWidgets).filter(widgetId => dash.props.widgets[widgetId].type.name == \"MapWidget\").map(widgetId =>\r\n                <option value={widgetId}>{mapWidgets[widgetId].title} - {widgetId}</option>);\r\n        }\r\n        else if (name == \"typeName\") {\r\n            return this.state.layers.map(m => <option value={m.name}>{m.layer_params.title}</option>);\r\n        }\r\n        else if (name == \"aggregationAttribute\") {\r\n            var isNumber = a => ['xsd:int', 'xsd:long', 'xsd:double'].indexOf(a.attribute_type) != -1;\r\n            return this.state.attributes.filter(a => isNumber(a))\r\n                .map(a => <option value={a.attribute}>{a.attribute_label || a.attribute}</option>);\r\n        }\r\n        return super.getSelectOptions(name, config, value);\r\n    }\r\n\r\n    updateAttributes(data) {\r\n        //this.state.data.typeName = this.fields.typeName.value;\r\n        this.setState({data: data || this.getData()});\r\n        getAttributesData(this.fields.typeName.value).then(res => this.setState({attributes: res.objects}));\r\n    }\r\n\r\n    componentDidMount() {\r\n        if (this.fields.mapWidget.value)\r\n            getMapLayersData(dash.props.widgets[this.fields.mapWidget.value].props.config.mapId).then(res => {\r\n                this.setLayers(res);\r\n                // debugger;\r\n                if (this.state.data.typeName) {\r\n                    // console.log(this.state.data.typeName)\r\n                    this.updateAttributes(this.state.data);\r\n                }\r\n            });\r\n    }\r\n\r\n    setLayers(res) {\r\n        this.setState({layers: res.objects});\r\n        //res.objects.map(l => this.layersHash[l.typename] = l);\r\n    }\r\n\r\n    // getData( ) {\r\n    //   debugger;\r\n    //   const data = super.getData( )\r\n    //   data.groupBy = {\r\n    //       attributes: data.groupBy\r\n    //   };\r\n    //   return data;\r\n    // }\r\n\r\n}\r\n\r\nAggregateWidget.ConfigForm = ConfigFieldSet;\r\nDashboard.registerWidget(AggregateWidget);\r\nexport default AggregateWidget;\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/aggregate-widget.jsx"],"sourceRoot":""}