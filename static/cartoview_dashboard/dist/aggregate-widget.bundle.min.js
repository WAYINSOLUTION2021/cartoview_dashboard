webpackJsonp([7],{14:function(t,e,n){"use strict";e.__esModule=!0;var r=n(19);e.default=new r.EventEmitter},19:function(t,e){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(t){return"function"==typeof t}function i(t){return"number"==typeof t}function o(t){return"object"==typeof t&&null!==t}function s(t){return void 0===t}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(t){if(!i(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},n.prototype.emit=function(t){var e,n,i,a,u,l;if(this._events||(this._events={}),"error"===t&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var p=new Error('Uncaught, unspecified "error" event. ('+e+")");throw p.context=e,p}if(n=this._events[t],s(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(o(n))for(a=Array.prototype.slice.call(arguments,1),l=n.slice(),i=l.length,u=0;u<i;u++)l[u].apply(this,a);return!0},n.prototype.addListener=function(t,e){var i;if(!r(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,r(e.listener)?e.listener:e),this._events[t]?o(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,o(this._events[t])&&!this._events[t].warned&&(i=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&i>0&&this._events[t].length>i&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(t,e){function n(){this.removeListener(t,n),i||(i=!0,e.apply(this,arguments))}if(!r(e))throw TypeError("listener must be a function");var i=!1;return n.listener=e,this.on(t,n),this},n.prototype.removeListener=function(t,e){var n,i,s,a;if(!r(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],s=n.length,i=-1,n===e||r(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(o(n)){for(a=s;a-- >0;)if(n[a]===e||n[a].listener&&n[a].listener===e){i=a;break}if(i<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},n.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],r(n))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},n.prototype.listeners=function(t){return this._events&&this._events[t]?r(this._events[t])?[this._events[t]]:this._events[t].slice():[]},n.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(r(e))return 1;if(e)return e.length}return 0},n.listenerCount=function(t,e){return t.listenerCount(e)}},585:function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a=function(){var t="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;return function(e,n,r,i){var o=e&&e.defaultProps,s=arguments.length-3;if(n||0===s||(n={}),n&&o)for(var a in o)void 0===n[a]&&(n[a]=o[a]);else n||(n=o||{});if(1===s)n.children=i;else if(s>1){for(var u=Array(s),l=0;l<s;l++)u[l]=arguments[l+3];n.children=u}return{$$typeof:t,type:e,key:void 0===r?null:""+r,ref:null,props:n,_owner:null}}}(),u=n(2),l=(r(u),n(9)),p=r(l),f=n(14),c=r(f),h=function(t){function e(n){i(this,e);var r=o(this,t.call(this,n));return r.wpsClient=new WpsClient({geoserverUrl:"/geoserver"}),r.state.aggregateResult="NaN",r.configFieldSetClass=d,r}return s(e,t),e.prototype.setConfig=function(e){t.prototype.setConfig.call(this,e),this.attachToMapWidget(e.mapWidget)},e.prototype.componentDidMount=function(){this.state.config.mapWidget&&this.attachToMapWidget(this.state.config.mapWidget),this.update(this.state.config)},e.prototype.attachToMapWidget=function(t){var e=this,n="mapExtentChanged_"+t;console.log(n),c.default.on(n,function(t,n){e.update(e.state.config,n)})},e.prototype.update=function(t,e){var n=this;t.typeName&&(t=Object.assign({},t),e&&(t.filters={minx:e[0],miny:e[1],maxx:e[2],maxy:e[3]}),this.wpsClient.aggregate(t).then(function(t){n.setData(t)}))},e.prototype.setData=function(t){this.setState({aggregateResult:t.AggregationResults[0][0]})},e.prototype.render=function(){return a("div",{className:"aggregate-widget"},void 0,a("h1",{className:"text-center"},void 0,this.state.aggregateResult))},e}(BaseWidget),d=function(t){function e(n){i(this,e);var r=o(this,t.call(this,n));return console.log(n),r.state.layers=[],r.state.attributes=[],r.state.map=null,r}return s(e,t),e.prototype.getInitialData=function(t){return t.widget.getConfig()},e.prototype.getSchema=function(){var t=this;return{mapWidget:{type:"select",label:"Map",options:{},props:{onChange:function(e){getMapLayersData(dash.props.widgets[t.fields.mapWidget.value].props.config.mapId).then(function(e){t.setState({data:t.getData()}),t.setState({layers:e.objects})})}}},typeName:{type:"select",label:"Layer",options:{},props:{onChange:function(t){t.target.fieldSet.updateAttributes()}}},aggregationAttribute:{type:"select",label:"Aggregation Attribute",options:{}},aggregationFunction:{type:"select",label:"Aggregation Function",defaultValue:"Sum",options:{Sum:"Sum",Count:"Count",Average:"Average",Max:"Max",Min:"Min",Median:"Median"}}}},e.prototype.getSelectOptions=function(e,n,r){if("mapWidget"==e)return Object.keys(dash.props.widgets).filter(function(t){return"MapWidget"==dash.props.widgets[t].type.name}).map(function(t){return a("option",{value:t},void 0,dash.props.widgets[t].title)});if("typeName"==e)return this.state.layers.map(function(t){return a("option",{value:t.name},void 0,t.layer_params.title)});if("aggregationAttribute"==e){var i=function(t){return-1!=["xsd:int","xsd:long","xsd:double"].indexOf(t.attribute_type)};return this.state.attributes.filter(function(t){return i(t)}).map(function(t){return a("option",{value:t.attribute},void 0,t.attribute_label||t.attribute)})}return t.prototype.getSelectOptions.call(this,e,n,r)},e.prototype.updateAttributes=function(t){var e=this;this.setState({data:t||this.getData()}),getAttributesData(this.fields.typeName.value).then(function(t){return e.setState({attributes:t.objects})})},e.prototype.componentDidMount=function(){var t=this;this.fields.mapWidget.value&&getMapLayersData(dash.props.widgets[this.fields.mapWidget.value].props.config.mapId).then(function(e){t.setLayers(e),t.state.data.typeName&&t.updateAttributes(t.state.data)})},e.prototype.setLayers=function(t){this.setState({layers:t.objects})},e}(p.default);h.ConfigForm=d,Dashboard.registerWidget(h),e.default=h},9:function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l=function(){var t="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;return function(e,n,r,i){var o=e&&e.defaultProps,s=arguments.length-3;if(n||0===s||(n={}),n&&o)for(var a in o)void 0===n[a]&&(n[a]=o[a]);else n||(n=o||{});if(1===s)n.children=i;else if(s>1){for(var u=Array(s),l=0;l<s;l++)u[l]=arguments[l+3];n.children=u}return{$$typeof:t,type:e,key:void 0===r?null:""+r,ref:null,props:n,_owner:null}}}(),p=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},f=n(2),c=r(f),h=function(t){function e(n){o(this,e);var r=s(this,t.call(this,n));return Object.defineProperty(r,"value",{get:function(){return JSON.parse(r.refs.textarea.value)},set:function(t){r.refs.textarea.value=JSON.stringify(t||{})},enumerable:!0,configurable:!0}),r}return a(e,t),e.prototype.render=function(){var t=i(this.props,[]);return delete t.ref,c.default.createElement("textarea",p({},t,{ref:"textarea"}))},e}(f.Component),d=function(t){function e(n){o(this,e);var r=s(this,t.call(this,n));return r.state={schema:n.schema||r.getSchema(n),data:n.data||r.getInitialData(n)},r.fields={},r}return a(e,t),e.prototype.getSchema=function(){return{}},e.prototype.getInitialData=function(){return{}},e.prototype.render=function(){var t=this,e=this.state,n=e.schema,r=e.data;return l("div",{},void 0,Object.keys(n).map(function(e){return t.field(e,n[e],n[e].getValue?n[e].getValue(r):r[e]||null)}))},e.prototype.field=function(t,e,n){var r=this,i=e.props,o=void 0===i?{}:i;o.className="form-control",o.ref=function(e){e&&(e.value=n,r.fields[t]=e,e.fieldSet=r)};var s=null;-1!=["text","number","url","email"].indexOf(e.type)?(o.type=e.type,s=c.default.createElement("input",o)):"textarea"==e.type?s=c.default.createElement("textarea",o):"json"==e.type?s=c.default.createElement(h,o):"select"==e.type&&(s=c.default.createElement("select",o,this.getSelectOptions(t,e,n)));var a=e.label||t.charAt(0).toUpperCase()+t.slice(1);return l("div",{className:"form-group"},void 0,l("label",{},void 0,a),s)},e.prototype.getSelectOptions=function(t,e,n){var r=e.options;return r?"object"==(void 0===r?"undefined":u(r))?Object.keys(r).map(function(t){return l("option",{value:t},void 0,r[t])}):"function"==typeof r?r(this,this.state.data):null:null},e.prototype.getData=function(){var t=this,e={};return Object.keys(this.fields).map(function(n){e[n]=t.fields[n].value}),e},e}(f.Component);e.default=d}},[585]);