webpackJsonp([7],{11:function(t,e,n){"use strict";e.__esModule=!0;var r=n(18);e.default=new r.EventEmitter},18:function(t,e,n){"use strict";function r(t){console&&console.warn&&console.warn(t)}function i(){i.init.call(this)}function o(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function a(t){return void 0===t._maxListeners?i.defaultMaxListeners:t._maxListeners}function s(t,e,n,i){var s,u,l;if(o(n),u=t._events,void 0===u?(u=t._events=Object.create(null),t._eventsCount=0):(void 0!==u.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),u=t._events),l=u[e]),void 0===l)l=u[e]=n,++t._eventsCount;else if("function"==typeof l?l=u[e]=i?[n,l]:[l,n]:i?l.unshift(n):l.push(n),(s=a(t))>0&&l.length>s&&!l.warned){l.warned=!0;var f=new Error("Possible EventEmitter memory leak detected. "+l.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");f.name="MaxListenersExceededWarning",f.emitter=t,f.type=e,f.count=l.length,r(f)}return t}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=u.bind(r);return i.listener=n,r.wrapFn=i,i}function f(t,e,n){var r=t._events;if(void 0===r)return[];var i=r[e];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?d(i):c(i,i.length)}function p(t){var e=this._events;if(void 0!==e){var n=e[t];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function c(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function h(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function d(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}var y,g="object"==typeof Reflect?Reflect:null,v=g&&"function"==typeof g.apply?g.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)};y=g&&"function"==typeof g.ownKeys?g.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var m=Number.isNaN||function(t){return t!==t};t.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var b=10;Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return b},set:function(t){if("number"!=typeof t||t<0||m(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");b=t}}),i.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||m(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},i.prototype.getMaxListeners=function(){return a(this)},i.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var r="error"===t,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var o;if(e.length>0&&(o=e[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var s=i[t];if(void 0===s)return!1;if("function"==typeof s)v(s,this,e);else for(var u=s.length,l=c(s,u),n=0;n<u;++n)v(l[n],this,e);return!0},i.prototype.addListener=function(t,e){return s(this,t,e,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(t,e){return s(this,t,e,!0)},i.prototype.once=function(t,e){return o(e),this.on(t,l(this,t,e)),this},i.prototype.prependOnceListener=function(t,e){return o(e),this.prependListener(t,l(this,t,e)),this},i.prototype.removeListener=function(t,e){var n,r,i,a,s;if(o(e),void 0===(r=this._events))return this;if(void 0===(n=r[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(i=-1,a=n.length-1;a>=0;a--)if(n[a]===e||n[a].listener===e){s=n[a].listener,i=a;break}if(i<0)return this;0===i?n.shift():h(n,i),1===n.length&&(r[t]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",t,s||e)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(t){var e,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(void 0!==e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},i.prototype.listeners=function(t){return f(this,t,!0)},i.prototype.rawListeners=function(t){return f(this,t,!1)},i.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):p.call(t,e)},i.prototype.listenerCount=p,i.prototype.eventNames=function(){return this._eventsCount>0?y(this._events):[]}},548:function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=n(11),u=r(s),l=n(7),f=r(l),p=n(1),c=r(p),h=function(t){function e(n){i(this,e);var r=o(this,t.call(this,n));return r.wpsClient=new WpsClient({geoserverUrl:"/geoserver"}),r.state.aggregateResult="NaN",r.configFieldSetClass=d,r}return a(e,t),e.prototype.setConfig=function(e){t.prototype.setConfig.call(this,e),this.attachToMapWidget(e)},e.prototype.componentDidMount=function(){this.state.config.mapWidget&&this.attachToMapWidget(this.state.config),this.update(this.state.config),t.prototype.componentDidMount.call(this)},e.prototype.attachToMapWidget=function(t){var e=this,n=this.context.configManager.getWidget(t.mapWidget);n&&n.ready&&this.update(t,n.map.getView().calculateExtent());var r="mapExtentChanged_"+t.mapWidget;u.default.on(r,function(t,n){e.update(e.state.config,n)})},e.prototype.update=function(t,e){var n=this;t.typeName&&(t=Object.assign({},t),e&&(t.filters={minx:e[0],miny:e[1],maxx:e[2],maxy:e[3]}),this.wpsClient.aggregate(t).then(function(t){n.setData(t)}))},e.prototype.setData=function(t){this.setState({aggregateResult:t.AggregationResults[0][0]})},e.prototype.render=function(){return c.default.createElement("div",{className:"aggregate-widget"},c.default.createElement("h1",{className:"text-center"},this.state.aggregateResult))},e}(BaseWidget);h.displayName="Aggregate Widget";var d=function(t){function e(n){i(this,e);var r=o(this,t.call(this,n));return console.log(n),r.state.layers=[],r.state.attributes=[],r.state.map=null,r}return a(e,t),e.prototype.getInitialData=function(t){return t.widget.getConfig()},e.prototype.getSchema=function(){var t=this;return{mapWidget:{type:"select",label:"Map",options:{},props:{onChange:function(e){getMapLayersData(dash.props.widgets[t.fields.mapWidget.value].props.config.mapId).then(function(e){t.setState({data:t.getData()}),t.setState({layers:e.objects})})}}},typeName:{type:"select",label:"Layer",options:{},props:{onChange:function(t){t.target.fieldSet.updateAttributes()}}},aggregationAttribute:{type:"select",label:"Aggregation Attribute",options:{}},aggregationFunction:{type:"select",label:"Aggregation Function",defaultValue:"Sum",options:{Sum:"Sum",Count:"Count",Average:"Average",Max:"Max",Min:"Min",Median:"Median"}}}},e.prototype.getSelectOptions=function(e,n,r){if("mapWidget"==e){var i=this.props.widget.context.configManager.getMapWidgets();return Object.keys(i).filter(function(t){return"MapWidget"==dash.props.widgets[t].type.name}).map(function(t,e){return c.default.createElement("option",{key:e,value:t},i[t].title," - ",t)})}if("typeName"==e)return this.state.layers.map(function(t,e){return c.default.createElement("option",{key:e,value:t.name},t.layer_params.title)});if("aggregationAttribute"==e){var o=function(t){return-1!=["xsd:int","xsd:long","xsd:double"].indexOf(t.attribute_type)};return this.state.attributes.filter(function(t){return o(t)}).map(function(t,e){return c.default.createElement("option",{key:e,value:t.attribute},t.attribute_label||t.attribute)})}return t.prototype.getSelectOptions.call(this,e,n,r)},e.prototype.updateAttributes=function(t){var e=this;this.setState({data:t||this.getData()}),getAttributesData(this.fields.typeName.value).then(function(t){return e.setState({attributes:t.objects})})},e.prototype.componentDidMount=function(){var t=this;this.fields.mapWidget.value&&getMapLayersData(dash.props.widgets[this.fields.mapWidget.value].props.config.mapId).then(function(e){t.setLayers(e),t.state.data.typeName&&t.updateAttributes(t.state.data)})},e.prototype.setLayers=function(t){this.setState({layers:t.objects})},e}(f.default);h.ConfigForm=d,Dashboard.registerWidget(h),e.default=h},7:function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},f=n(1),p=r(f),c=function(t){function e(n){o(this,e);var r=a(this,t.call(this,n));return Object.defineProperty(r,"value",{get:function(){return JSON.parse(r.refs.textarea.value)},set:function(t){r.refs.textarea.value=JSON.stringify(t||{})},enumerable:!0,configurable:!0}),r}return s(e,t),e.prototype.render=function(){var t=i(this.props,[]);return delete t.ref,p.default.createElement("textarea",l({},t,{ref:"textarea"}))},e}(f.Component),h=function(t){function e(n){o(this,e);var r=a(this,t.call(this,n));return r.state={schema:n.schema||r.getSchema(n),data:n.data||r.getInitialData(n)},r.fields={},r}return s(e,t),e.prototype.getSchema=function(){return{}},e.prototype.getInitialData=function(){return{}},e.prototype.render=function(){var t=this,e=this.state,n=e.schema,r=e.data;return p.default.createElement("div",null,r&&Object.keys(n).map(function(e,i){var o=t.field(e,n[e],n[e].getValue?n[e].getValue(r):r[e]||null);return p.default.createElement("div",{key:i},o)}))},e.prototype.field=function(t,e,n){var r=this,i=e.props,o=void 0===i?{}:i;o.className="form-control",o.ref=function(e){e&&(e.value=n,r.fields[t]=e,e.fieldSet=r)};var a=null;-1!=["text","number","url","email"].indexOf(e.type)?(o.type=e.type,a=p.default.createElement("input",o)):"textarea"==e.type?a=p.default.createElement("textarea",o):"json"==e.type?a=p.default.createElement(c,o):"select"==e.type&&(a=p.default.createElement("select",o,this.getSelectOptions(t,e,n)));var s=e.label||t.charAt(0).toUpperCase()+t.slice(1);return p.default.createElement("div",{className:"form-group"},p.default.createElement("label",null,s),a)},e.prototype.getSelectOptions=function(t,e,n){var r=e.options;return r?"object"==(void 0===r?"undefined":u(r))?Object.keys(r).map(function(t){return p.default.createElement("option",{value:t},r[t])}):"function"==typeof r?r(this,this.state.data):null:null},e.prototype.getData=function(){var t=this,e={};return Object.keys(this.fields).map(function(n){e[n]=t.fields[n].value}),e},e}(f.Component);e.default=h}},[548]);